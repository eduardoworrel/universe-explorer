"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _createSuper(i){var n=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(i);return _possibleConstructorReturn(this,n?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=_superPropBase(t,e);if(n)return n=Object.getOwnPropertyDescriptor(n,e),n.get?n.get.call(arguments.length<3?t:i):n.value}).apply(this,arguments)}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function _createForOfIteratorHelper(t,e){var i,n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length)return n&&(t=n),i=0,{s:e=function(){},n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}var nipplejs={exports:{}};window,nipplejs.exports=function(i){var n={};function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}return o.m=i,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,i){i.r(e);function g(t,e){var i=e.x-t.x,e=e.y-t.y;return Math.sqrt(i*i+e*e)}function b(t){return t*(Math.PI/180)}function o(t){d.has(t)&&clearTimeout(d.get(t)),d.set(t,setTimeout(t,100))}function s(t,e,i){for(var n,o=e.split(/[ ,]+/g),s=0;s<o.length;s+=1)n=o[s],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)}function n(t,e,i){for(var n,o=e.split(/[ ,]+/g),s=0;s<o.length;s+=1)n=o[s],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)}function r(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t}function a(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}}function k(t,e){e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function c(t,e,i){var n,o=h(t);for(n in o)if(o.hasOwnProperty(n))if("string"==typeof e)o[n]=e+" "+i;else{for(var s="",r=0,a=e.length;r<a;r+=1)s+=e[r]+" "+i+", ";o[n]=s.slice(0,-2)}return o}function h(e){var i={};return i[e]="",["webkit","Moz","o"].forEach(function(t){i[t+e.charAt(0).toUpperCase()+e.slice(1)]=""}),i}function u(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}function l(t,e){if(t.length)for(var i=0,n=t.length;i<n;i+=1)e(t[i]);else e(t)}var p,d=new Map,i=!!("ontouchstart"in window),f=!!window.PointerEvent,y=!!window.MSPointerEvent,m={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function _(){}f?p={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:y?p={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:i?(p={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},v=m):p=m,_.prototype.on=function(t,e){var i,n=t.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var o=0;o<n.length;o+=1)i=n[o],this._handlers_[i]=this._handlers_[i]||[],this._handlers_[i].push(e);return this},_.prototype.off=function(t,e){return this._handlers_=this._handlers_||{},void 0===t?this._handlers_={}:void 0===e?this._handlers_[t]=null:this._handlers_[t]&&0<=this._handlers_[t].indexOf(e)&&this._handlers_[t].splice(this._handlers_[t].indexOf(e),1),this},_.prototype.trigger=function(t,e){var i,n=this,o=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var s=0;s<o.length;s+=1)i=o[s],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach(function(t){t.call(n,{type:i,target:n},e)})},_.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&e.hasOwnProperty(i)?n[i]=e[i]:t.hasOwnProperty(i)&&(n[i]=t[i]);return n}(this.options,t))},_.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},s(t,p[e],i._domHandlers_[e]),v[e]&&s(t,v[e],i._domHandlers_[e]),i},_.prototype.unbindEvt=function(t,e){return this._domHandlers_=this._domHandlers_||{},n(t,p[e],this._domHandlers_[e]),v[e]&&n(t,v[e],this._domHandlers_[e]),delete this._domHandlers_[e],this};f=_;function w(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=w.id,w.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}w.prototype=new f,(w.constructor=w).id=0,w.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},w.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=function(){var t,e=h("borderRadius");for(t in e)e.hasOwnProperty(t)&&(e[t]="50%");return e}(),t=c("transition","opacity",t),i={};return i.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},i.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},i.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},u(i.el,t),"circle"===this.options.shape&&u(i.back,e),u(i.front,e),this.applyStyles(i),this},w.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},w.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},w.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},w.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},w.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)},e.options.fadeTime)),e},w.prototype.hide=function(e){var t,i,n=this;return n.options.dataOnly||(n.ui.el.style.opacity=n.options.restOpacity,clearTimeout(n.removeTimeout),clearTimeout(n.showTimeout),clearTimeout(n.restTimeout),n.removeTimeout=setTimeout(function(){var t="dynamic"===n.options.mode?"none":"block";n.ui.el.style.display=t,"function"==typeof e&&e.call(n),n.trigger("hidden",n.instance)},n.options.fadeTime),n.options.restJoystick&&(t=n.options.restJoystick,(i={}).x=!0===t||!1!==t.x?0:n.instance.frontPosition.x,i.y=!0===t||!1!==t.y?0:n.instance.frontPosition.y,n.setPosition(e,i))),n},w.prototype.setPosition=function(t,e){var i=this,e=(i.frontPosition={x:e.x,y:e.y},i.options.fadeTime+"ms"),n={},e=(n.front=c("transition",["top","left"],e),{front:{}});e.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(e),i.restTimeout=setTimeout(function(){"function"==typeof t&&t.call(i),i.restCallback()},i.options.fadeTime)},w.prototype.restCallback=function(){var t={};t.front=c("transition","none",""),this.applyStyles(t),this.trigger("rested",this.instance)},w.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},w.prototype.computeDirection=function(t){var e,i,n,o=t.angle.radian,s=Math.PI/4,r=Math.PI/2;if(s<o&&o<3*s&&!t.lockX?e="up":-s<o&&o<=s&&!t.lockY?e="left":3*-s<o&&o<=-s&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=-r<o&&o<r?"left":"right"),t.lockX||(n=0<o?"up":"down"),t.force>this.options.threshold){var a,c={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(c[a]=this.direction[a]);var h={};for(a in this.direction={x:i,y:n,angle:e},t.direction=this.direction,c)c[a]===this.direction[a]&&(h[a]=!0);if(h.x&&h.y&&h.angle)return t;h.x&&h.y||this.trigger("plain",t),h.x||this.trigger("plain:"+i,t),h.y||this.trigger("plain:"+n,t),h.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t};var E=w;function T(t,e){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=t,this.id=T.id,T.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(e),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);t=getComputedStyle(this.options.zone.parentElement);return t&&"flex"===t.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}T.prototype=new f,(T.constructor=T).id=0,T.prototype.prepareNipples=function(){var n=this.nipples;n.on=this.on.bind(this),n.off=this.off.bind(this),n.options=this.options,n.destroy=this.destroy.bind(this),n.ids=this.ids,n.id=this.id,n.processOnMove=this.processOnMove.bind(this),n.processOnEnd=this.processOnEnd.bind(this),n.get=function(t){if(void 0===t)return n[0];for(var e=0,i=n.length;e<i;e+=1)if(n[e].identifier===t)return n[e];return!1}},T.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},T.prototype.begin=function(){var t=this.options;"static"===t.mode&&((t=this.createNipple(t.position,this.manager.getIdentifier())).add(),this.idles.push(t))},T.prototype.createNipple=function(t,e){var i=this.manager.scroll,n={},o=this.options,s=this.parentIsFlex?i.x:i.x+this.box.left,r=this.parentIsFlex?i.y:i.y+this.box.top,s=(t.x&&t.y?n={x:t.x-s,y:t.y-r}:(t.top||t.right||t.bottom||t.left)&&((s=document.createElement("DIV")).style.display="hidden",s.style.top=t.top,s.style.right=t.right,s.style.bottom=t.bottom,s.style.left=t.left,s.style.position="absolute",o.zone.appendChild(s),r=s.getBoundingClientRect(),o.zone.removeChild(s),n=t,t={x:r.left+i.x,y:r.top+i.y}),new E(this,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:t,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape}));return o.dataOnly||(k(s.ui.el,n),k(s.ui.front,s.frontPosition)),this.nipples.push(s),this.trigger("added "+s.identifier+":added",s),this.manager.trigger("added "+s.identifier+":added",s),this.bindNipple(s),s},T.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},T.prototype.bindNipple=function(t){function e(t,e){i=t.type+" "+e.id+":"+t.type,n.trigger(i,e)}var i,n=this;t.on("destroyed",n.onDestroyed.bind(n)),t.on("shown hidden rested dir plain",e),t.on("dir:up dir:right dir:down dir:left",e),t.on("plain:up plain:right plain:down plain:left",e)},T.prototype.pressureFn=function(e,i,t){var n=this,o=0;clearInterval(n.pressureIntervals[t]),n.pressureIntervals[t]=setInterval(function(){var t=e.force||e.pressure||e.webkitForce||0;t!==o&&(i.trigger("pressure",t),n.trigger("pressure "+i.identifier+":pressure",t),o=t)}.bind(n),100)},T.prototype.onstart=function(i){var n=this,e=n.options,o=i;return i=r(i),n.updateBox(),l(i,function(t){n.actives.length<e.maxNumberOfNipples?n.processOnStart(t):o.type.match(/^touch/)&&(Object.keys(n.manager.ids).forEach(function(e){var t;Object.values(o.touches).findIndex(function(t){return t.identifier===e})<0&&((t=[i[0]]).identifier=e,n.processOnEnd(t))}),n.actives.length<e.maxNumberOfNipples&&n.processOnStart(t))}),n.manager.bindDocument(),!1},T.prototype.processOnStart=function(e){function t(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),0<s&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)}var i=this,n=i.options,o=i.manager.getIdentifier(e),s=e.force||e.pressure||e.webkitForce||0,r={x:e.pageX,y:e.pageY},a=i.getOrCreate(o,r);a.identifier!==o&&i.manager.removeIdentifier(a.identifier),a.identifier=o;if(0<=(o=i.idles.indexOf(a))&&i.idles.splice(o,1),i.actives.push(a),i.ids.push(a.identifier),"semi"!==n.mode)t(a);else{if(!(g(r,a.position)<=n.catchDistance))return a.destroy(),void i.processOnStart(e);t(a)}return a},T.prototype.getOrCreate=function(t,e){var i,n=this.options;return/(semi|static)/.test(n.mode)?(i=this.idles[0])?(this.idles.splice(0,1),i):"semi"===n.mode?this.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):this.createNipple(e,t)},T.prototype.processOnMove=function(t){var e=this.options,i=this.manager.getIdentifier(t),n=this.nipples.get(i),o=this.manager.scroll;if(s=t,isNaN(s.buttons)?0!==s.pressure:0!==s.buttons){if(!n)return console.error("Found zombie joystick with ID "+i),void this.manager.removeIdentifier(i);e.dynamicPage&&(s=n.el.getBoundingClientRect(),n.position={x:o.x+s.left,y:o.y+s.top}),n.identifier=i;var s=n.options.size/2,i={x:t.pageX,y:t.pageY};e.lockX&&(i.y=n.position.y),e.lockY&&(i.x=n.position.x);var r,a,c,h,u,l=g(i,n.position),p=(p=i,d=n.position,f=d.x-p.x,d=d.y-p.y,Math.atan2(d,f)*(180/Math.PI)),d=b(p),f=l/s,y={distance:l,position:i},m=("circle"===n.options.shape?(r=Math.min(l,s),a=n.position,c=r,u={x:0,y:0},h=b(p),u.x=a.x-c*Math.cos(h),u.y=a.y-c*Math.sin(h),a=u):(c=i,h=n.position,u=s,a={x:Math.min(Math.max(c.x,h.x-u),h.x+u),y:Math.min(Math.max(c.y,h.y-u),h.y+u)},r=g(a,n.position)),e.follow?s<l&&(m=i.x-a.x,v=i.y-a.y,n.position.x+=m,n.position.y+=v,n.el.style.top=n.position.y-(this.box.top+o.y)+"px",n.el.style.left=n.position.x-(this.box.left+o.x)+"px",l=g(i,n.position)):(i=a,l=r),i.x-n.position.x),v=i.y-n.position.y,o=(n.frontPosition={x:m,y:v},e.dataOnly||k(n.ui.front,n.frontPosition),{identifier:n.identifier,position:i,force:f,pressure:t.force||t.pressure||t.webkitForce||0,distance:l,angle:{radian:d,degree:p},vector:{x:m/s,y:-v/s},raw:y,instance:n,lockX:e.lockX,lockY:e.lockY});(o=n.computeDirection(o)).angle={radian:b(180-p),degree:180-p},n.trigger("move",o),this.trigger("move "+n.id+":move",o)}else this.processOnEnd(t)},T.prototype.processOnEnd=function(t){var e=this,i=e.options,t=e.manager.getIdentifier(t),n=e.nipples.get(t),t=e.manager.removeIdentifier(n.identifier);n&&(i.dataOnly||n.hide(function(){"dynamic"===i.mode&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),0<=e.ids.indexOf(n.identifier)&&e.ids.splice(e.ids.indexOf(n.identifier),1),0<=e.actives.indexOf(n)&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):0<=e.nipples.indexOf(n)&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[t.id]=t.identifier))},T.prototype.onDestroyed=function(t,e){0<=this.nipples.indexOf(e)&&this.nipples.splice(this.nipples.indexOf(e),1),0<=this.actives.indexOf(e)&&this.actives.splice(this.actives.indexOf(e),1),0<=this.idles.indexOf(e)&&this.idles.splice(this.idles.indexOf(e),1),0<=this.ids.indexOf(e.identifier)&&this.ids.splice(this.ids.indexOf(e.identifier),1),this.manager.removeIdentifier(e.identifier),this.manager.unbindDocument()},T.prototype.destroy=function(){for(var t in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(t){t.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(t)&&clearInterval(this.pressureIntervals[t]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()};var x=T;function P(t){function e(){var e;n.collections.forEach(function(t){t.forEach(function(t){e=t.el.getBoundingClientRect(),t.position={x:n.scroll.x+e.left,y:n.scroll.y+e.top}})})}function i(){n.scroll=a()}var n=this;n.ids={},n.index=0,n.collections=[],n.scroll=a(),n.config(t),n.prepareCollections(),s(window,"resize",function(){o(e)});return s(window,"scroll",function(){o(i)}),n.collections}P.prototype=new f,(P.constructor=P).prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(t){return!(i=t.get(e))}),i}},P.prototype.create=function(t){return this.createCollection(t)},P.prototype.createCollection=function(t){t=new x(this,t);return this.bindCollection(t),this.collections.push(t),t},P.prototype.bindCollection=function(t){function e(t,e){i=t.type+" "+e.id+":"+t.type,n.trigger(i,e)}var i,n=this;t.on("destroyed",n.onDestroyed.bind(n)),t.on("shown hidden rested dir plain",e),t.on("dir:up dir:right dir:down dir:left",e),t.on("plain:up plain:right plain:down plain:left",e)},P.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},P.prototype.unbindDocument=function(t){Object.keys(this.ids).length&&!0!==t||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},P.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},P.prototype.removeIdentifier=function(t){var e,i={};for(e in this.ids)if(this.ids[e]===t){i.id=e,i.identifier=this.ids[e],delete this.ids[e];break}return i},P.prototype.onmove=function(t){return this.onAny("move",t),!1},P.prototype.onend=function(t){return this.onAny("end",t),!1},P.prototype.oncancel=function(t){return this.onAny("end",t),!1},P.prototype.onAny=function(t,e){var i,n=this,o="processOn"+t.charAt(0).toUpperCase()+t.slice(1);return e=r(e),l(e,function(t){i=n.getIdentifier(t),l(n.collections,function(t,e,i){0<=i.ids.indexOf(e)&&(i[o](t),t._found_=!0)}.bind(null,t,i)),t._found_||n.removeIdentifier(i)}),!1},P.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(t){t.destroy()}),this.off()},P.prototype.onDestroyed=function(t,e){if(this.collections.indexOf(e)<0)return!1;this.collections.splice(this.collections.indexOf(e),1)};var O=new P;e.default={create:function(t){return O.create(t)},factory:O}}]).default;class Move$2{constructor(t){this.control=t}start(){var t=this.drawJoystick();this.attatchEvents(t)}drawJoystick(){const t=document.querySelector("#area");if(!t)throw new Error("O elemeno 'area' é obrigatório");const e=document.createElement("div");return e.style.position="fixed",e.style.width="100vw",e.style.height="100vh",t.prepend(e),nipplejs.exports.create({zone:e,mode:"dynamic",color:"white"})}attatchEvents(t){t.on("move",(t,e)=>{80<e.angle.degree&&e.angle.degree<100&&(this.control.directions=["ArrowUp"]),170<e.angle.degree&&e.angle.degree<190&&(this.control.directions=["ArrowLeft"]),260<e.angle.degree&&e.angle.degree<280&&(this.control.directions=["ArrowDown"]),(350<e.angle.degree||e.angle.degree<10)&&(this.control.directions=["ArrowRight"]),10<e.angle.degree&&e.angle.degree<80&&(this.control.directions=["ArrowUp","ArrowRight"]),100<e.angle.degree&&e.angle.degree<170&&(this.control.directions=["ArrowUp","ArrowLeft"]),190<e.angle.degree&&e.angle.degree<260&&(this.control.directions=["ArrowDown","ArrowLeft"]),280<e.angle.degree&&e.angle.degree<350&&(this.control.directions=["ArrowDown","ArrowRight"])}),t.on("end",()=>{this.control.directions=[]})}}class Move$1{constructor(t){this.control=t}start(){this.attatchEvents(),this.drawKeyboard()}drawKeyboard(){const t=document.createElement("div");t.style.position="fixed",t.style.bottom="3%",t.style.left="3%",t.innerHTML=`
      <button class="kbc-button up" 
        style='
          display: block;
          text-align: center;
          margin: 0 auto !important;
          '>	
            &#8593;
          </button>
      <button class="kbc-button left">  &#8592;</button>
      <button class="kbc-button down">  &#8595;</button>
      <button class="kbc-button right">	&#8594;</button>
    `,document.body.append(t)}attatchEvents(){window.addEventListener("keyup",t=>this.disableMove(t.key)),window.addEventListener("keydown",t=>{this.control.directions.includes(t.key)||this.control.directions.push(t.key)})}disableMove(e){this.control.directions=this.control.directions.filter(t=>t!==e)}}const position={vertical:60,horizontal:500},defaultSize={width:150,height:150},limit={maxX:3e3-defaultSize.width,maxY:3e3-defaultSize.height,minX:0,minY:0},speed={unit:"px",distance:7,ms:30};var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parseuri=function(t){for(var e=t,i=t.indexOf("["),n=t.indexOf("]"),o=(-1!=i&&-1!=n&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length)),re.exec(t||"")),s={},r=14;r--;)s[parts[r]]=o[r]||"";return-1!=i&&-1!=n&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=pathNames(s,s.path),s.queryKey=queryKey(s,s.query),s};function pathNames(t,e){var i=e.replace(/\/{2,9}/g,"/").split("/");return"/"!=e.substr(0,1)&&0!==e.length||i.splice(0,1),"/"==e.substr(e.length-1,1)&&i.splice(i.length-1,1),i}function queryKey(t,e){var n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,e,i){e&&(n[e]=i)}),n}function url(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=t,n=(2<arguments.length?arguments[2]:void 0)||"undefined"!=typeof location&&location;"string"==typeof(t=null==t?n.protocol+"//"+n.host:t)&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t=void 0!==n?n.protocol+"//"+t:"https://"+t),i=parseuri(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";t=-1!==i.host.indexOf(":")?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+t+":"+i.port+e,i.href=i.protocol+"://"+t+(n&&n.port===i.port?"":":"+i.port),i}var hasCors={exports:{}};try{hasCors.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){hasCors.exports=!1}var hasCORS=hasCors.exports,globalThis="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function XMLHttpRequest$1(t){t=t.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||hasCORS))return new XMLHttpRequest}catch(t){}if(!t)try{return new globalThis[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}function pick(i){for(var t=arguments.length,e=new Array(1<t?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return e.reduce(function(t,e){return i.hasOwnProperty(e)&&(t[e]=i[e]),t},{})}var NATIVE_SET_TIMEOUT=setTimeout,NATIVE_CLEAR_TIMEOUT=clearTimeout;function installTimerFunctions(t,e){e.useNativeTimers?(t.setTimeoutFn=NATIVE_SET_TIMEOUT.bind(globalThis),t.clearTimeoutFn=NATIVE_CLEAR_TIMEOUT.bind(globalThis)):(t.setTimeoutFn=setTimeout.bind(globalThis),t.clearTimeoutFn=clearTimeout.bind(globalThis))}var Emitter_1=Emitter;function Emitter(t){if(t)return mixin(t)}function mixin(t){for(var e in Emitter.prototype)t[e]=Emitter.prototype[e];return t}Emitter.prototype.on=Emitter.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},Emitter.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,n=this._callbacks["$"+t];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<n.length;o++)if((i=n[o])===e||i.fn===e){n.splice(o,1);break}return 0===n.length&&delete this._callbacks["$"+t],this},Emitter.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i)for(var n=0,o=(i=i.slice(0)).length;n<o;++n)i[n].apply(this,e);return this},Emitter.prototype.emitReserved=Emitter.prototype.emit,Emitter.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},Emitter.prototype.hasListeners=function(t){return!!this.listeners(t).length};for(var PACKET_TYPES=Object.create(null),PACKET_TYPES_REVERSE=(PACKET_TYPES.open="0",PACKET_TYPES.close="1",PACKET_TYPES.ping="2",PACKET_TYPES.pong="3",PACKET_TYPES.message="4",PACKET_TYPES.upgrade="5",PACKET_TYPES.noop="6",Object.create(null)),ERROR_PACKET=(Object.keys(PACKET_TYPES).forEach(function(t){PACKET_TYPES_REVERSE[PACKET_TYPES[t]]=t}),{type:"error",data:"parser error"}),withNativeBlob$1="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),withNativeArrayBuffer$2="function"==typeof ArrayBuffer,isView$1=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer},encodePacket=function(t,e,i){var n=t.type,t=t.data;return withNativeBlob$1&&t instanceof Blob?e?i(t):encodeBlobAsBase64(t,i):withNativeArrayBuffer$2&&(t instanceof ArrayBuffer||isView$1(t))?e?i(t):encodeBlobAsBase64(new Blob([t]),i):i(PACKET_TYPES[n]+(t||""))},encodeBlobAsBase64=function(t,e){var i=new FileReader;return i.onload=function(){var t=i.result.split(",")[1];e("b"+t)},i.readAsDataURL(t)},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lookup$1="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i$1=0;i$1<chars.length;i$1++)lookup$1[chars.charCodeAt(i$1)]=i$1;var prev,decode$1=function(t){for(var e,i,n,o,s=.75*t.length,r=t.length,a=0,s=("="===t[t.length-1]&&(s--,"="===t[t.length-2]&&s--),new ArrayBuffer(s)),c=new Uint8Array(s),h=0;h<r;h+=4)e=lookup$1[t.charCodeAt(h)],i=lookup$1[t.charCodeAt(h+1)],n=lookup$1[t.charCodeAt(h+2)],o=lookup$1[t.charCodeAt(h+3)],c[a++]=e<<2|i>>4,c[a++]=(15&i)<<4|n>>2,c[a++]=(3&n)<<6|63&o;return s},withNativeArrayBuffer$1="function"==typeof ArrayBuffer,decodePacket=function(t,e){if("string"!=typeof t)return{type:"message",data:mapBinary(t,e)};var i=t.charAt(0);return"b"===i?{type:"message",data:decodeBase64Packet(t.substring(1),e)}:PACKET_TYPES_REVERSE[i]?1<t.length?{type:PACKET_TYPES_REVERSE[i],data:t.substring(1)}:{type:PACKET_TYPES_REVERSE[i]}:ERROR_PACKET},decodeBase64Packet=function(t,e){var i;return withNativeArrayBuffer$1?(i=decode$1(t),mapBinary(i,e)):{base64:!0,data:t}},mapBinary=function(t,e){return"blob"===e&&t instanceof ArrayBuffer?new Blob([t]):t},SEPARATOR=String.fromCharCode(30),encodePayload=function(t,i){var n=t.length,o=new Array(n),s=0;t.forEach(function(t,e){encodePacket(t,!1,function(t){o[e]=t,++s===n&&i(o.join(SEPARATOR))})})},decodePayload=function(t,e){for(var i=t.split(SEPARATOR),n=[],o=0;o<i.length;o++){var s=decodePacket(i[o],e);if(n.push(s),"error"===s.type)break}return n},protocol$1=4,Transport=function(){_inherits(n,Emitter_1);var i=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=i.call(this)).writable=!1,installTimerFunctions(_assertThisInitialized(e),t),e.opts=t,e.query=t.query,e.readyState="",e.socket=t.socket,e}return _createClass(n,[{key:"onError",value:function(t,e){t=new Error(t);return t.type="TransportError",t.description=e,_get(_getPrototypeOf(n.prototype),"emit",this).call(this,"error",t),this}},{key:"open",value:function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}},{key:"close",value:function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}},{key:"send",value:function(t){"open"===this.readyState&&this.write(t)}},{key:"onOpen",value:function(){this.readyState="open",this.writable=!0,_get(_getPrototypeOf(n.prototype),"emit",this).call(this,"open")}},{key:"onData",value:function(t){t=decodePacket(t,this.socket.binaryType);this.onPacket(t)}},{key:"onPacket",value:function(t){_get(_getPrototypeOf(n.prototype),"emit",this).call(this,"packet",t)}},{key:"onClose",value:function(){this.readyState="closed",_get(_getPrototypeOf(n.prototype),"emit",this).call(this,"close")}}]),n}(),alphabet="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),length=64,map={},seed=0,i=0;function encode(t){for(var e="";e=alphabet[t%length]+e,0<(t=Math.floor(t/length)););return e}function decode(t){var e=0;for(i=0;i<t.length;i++)e=e*length+map[t.charAt(i)];return e}function yeast(){var t=encode(+new Date);return t!==prev?(seed=0,prev=t):t+"."+encode(seed++)}for(;i<length;i++)map[alphabet[i]]=i;yeast.encode=encode,yeast.decode=decode;var yeast_1=yeast,parseqs={encode:function(t){var e,i="";for(e in t)t.hasOwnProperty(e)&&(i.length&&(i+="&"),i+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]));return i},decode:function(t){for(var e={},i=t.split("&"),n=0,o=i.length;n<o;n++){var s=i[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},Polling=function(){_inherits(i,Transport);var e=_createSuper(i);function i(){var t;return _classCallCheck(this,i),(t=e.apply(this,arguments)).polling=!1,t}return _createClass(i,[{key:"name",get:function(){return"polling"}},{key:"doOpen",value:function(){this.poll()}},{key:"pause",value:function(t){function e(){n.readyState="paused",t()}var i,n=this;this.readyState="pausing";this.polling||!this.writable?(i=0,this.polling&&(i++,this.once("pollComplete",function(){--i||e()})),this.writable||(i++,this.once("drain",function(){--i||e()}))):e()}},{key:"poll",value:function(){this.polling=!0,this.doPoll(),this.emit("poll")}},{key:"onData",value:function(t){var e=this;decodePayload(t,this.socket.binaryType).forEach(function(t){if("opening"===e.readyState&&"open"===t.type&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}},{key:"doClose",value:function(){function t(){e.write([{type:"close"}])}var e=this;"open"===this.readyState?t():this.once("open",t)}},{key:"write",value:function(t){var e=this;this.writable=!1,encodePayload(t,function(t){e.doWrite(t,function(){e.writable=!0,e.emit("drain")})})}},{key:"uri",value:function(){var t=this.query||{},e=this.opts.secure?"https":"http",i="",t=(!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast_1()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"==e&&443!==Number(this.opts.port)||"http"==e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),parseqs.encode(t));return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(t.length?"?"+t:"")}}]),i}();function empty(){}var terminationEvent,hasXHR2=null!=new XMLHttpRequest$1({xdomain:!1}).responseType,XHR=function(){_inherits(s,Polling);var o=_createSuper(s);function s(t){_classCallCheck(this,s),e=o.call(this,t),"undefined"!=typeof location&&(i="https:"===location.protocol,n=(n=location.port)||(i?"443":"80"),e.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,e.xs=t.secure!==i);var e,i,n=t&&t.forceBase64;return e.supportsBinary=hasXHR2&&!n,e}return _createClass(s,[{key:"request",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Request(this.uri(),t)}},{key:"doWrite",value:function(t,e){var i=this,t=this.request({method:"POST",data:t});t.on("success",e),t.on("error",function(t){i.onError("xhr post error",t)})}},{key:"doPoll",value:function(){var e=this,t=this.request();t.on("data",this.onData.bind(this)),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t}}]),s}(),Request=function(){_inherits(o,Emitter_1);var n=_createSuper(o);function o(t,e){var i;return _classCallCheck(this,o),installTimerFunctions(_assertThisInitialized(i=n.call(this)),e),i.opts=e,i.method=e.method||"GET",i.uri=t,i.async=!1!==e.async,i.data=void 0!==e.data?e.data:null,i.create(),i}return _createClass(o,[{key:"create",value:function(){var e=this,t=pick(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref"),i=(t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs,this.xhr=new XMLHttpRequest$1(t));try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders)for(var n in i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0),this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&i.setRequestHeader(n,this.opts.extraHeaders[n])}catch(t){}if("POST"===this.method)try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{i.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=function(){4===i.readyState&&(200===i.status||1223===i.status?e.onLoad():e.setTimeoutFn(function(){e.onError("number"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(t){return void this.setTimeoutFn(function(){e.onError(t)},0)}"undefined"!=typeof document&&(this.index=o.requestsCount++,o.requests[this.index]=this)}},{key:"onSuccess",value:function(){this.emit("success"),this.cleanup()}},{key:"onData",value:function(t){this.emit("data",t),this.onSuccess()}},{key:"onError",value:function(t){this.emit("error",t),this.cleanup(!0)}},{key:"cleanup",value:function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=empty,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete o.requests[this.index],this.xhr=null}}},{key:"onLoad",value:function(){var t=this.xhr.responseText;null!==t&&this.onData(t)}},{key:"abort",value:function(){this.cleanup()}}]),o}();function unloadHandler(){for(var t in Request.requests)Request.requests.hasOwnProperty(t)&&Request.requests[t].abort()}Request.requestsCount=0,Request.requests={},"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",unloadHandler):"function"==typeof addEventListener&&(terminationEvent="onpagehide"in globalThis?"pagehide":"unload",addEventListener(terminationEvent,unloadHandler,!1)));var nextTick="function"==typeof Promise&&"function"==typeof Promise.resolve?function(t){return Promise.resolve().then(t)}:function(t,e){return e(t,0)},WebSocket=globalThis.WebSocket||globalThis.MozWebSocket,usingBrowserWebSocket=!0,defaultBinaryType="arraybuffer",isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),WS=function(){_inherits(n,Transport);var i=_createSuper(n);function n(t){var e;return _classCallCheck(this,n),(e=i.call(this,t)).supportsBinary=!t.forceBase64,e}return _createClass(n,[{key:"name",get:function(){return"websocket"}},{key:"doOpen",value:function(){if(this.check()){var t=this.uri(),e=this.opts.protocols,i=isReactNative?{}:pick(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=usingBrowserWebSocket&&!isReactNative?e?new WebSocket(t,e):new WebSocket(t):new WebSocket(t,e,i)}catch(t){return this.emit("error",t)}this.ws.binaryType=this.socket.binaryType||defaultBinaryType,this.addEventListeners()}}},{key:"addEventListeners",value:function(){var e=this;this.ws.onopen=function(){e.opts.autoUnref&&e.ws._socket.unref(),e.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=function(t){return e.onData(t.data)},this.ws.onerror=function(t){return e.onError("websocket error",t)}}},{key:"write",value:function(n){for(var o=this,t=(this.writable=!1,0);t<n.length;t++)!function(t){var e=n[t],i=t===n.length-1;encodePacket(e,o.supportsBinary,function(t){try{usingBrowserWebSocket&&o.ws.send(t)}catch(t){}i&&nextTick(function(){o.writable=!0,o.emit("drain")},o.setTimeoutFn)})}(t)}},{key:"doClose",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}},{key:"uri",value:function(){var t=this.query||{},e=this.opts.secure?"wss":"ws",i="",t=(this.opts.port&&("wss"==e&&443!==Number(this.opts.port)||"ws"==e&&80!==Number(this.opts.port))&&(i=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=yeast_1()),this.supportsBinary||(t.b64=1),parseqs.encode(t));return e+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+i+this.opts.path+(t.length?"?"+t:"")}},{key:"check",value:function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===n.prototype.name)}}]),n}(),transports={websocket:WS,polling:XHR},Socket$1=function(){_inherits(l,Emitter_1);var n=_createSuper(l);function l(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,l),e=n.call(this),t&&"object"===_typeof(t)&&(i=t,t=null),t?(t=parseuri(t),i.hostname=t.host,i.secure="https"===t.protocol||"wss"===t.protocol,i.port=t.port,t.query&&(i.query=t.query)):i.host&&(i.hostname=parseuri(i.host).host),installTimerFunctions(_assertThisInitialized(e),i),e.secure=null!=i.secure?i.secure:"undefined"!=typeof location&&"https:"===location.protocol,i.hostname&&!i.port&&(i.port=e.secure?"443":"80"),e.hostname=i.hostname||("undefined"!=typeof location?location.hostname:"localhost"),e.port=i.port||("undefined"!=typeof location&&location.port?location.port:e.secure?"443":"80"),e.transports=i.transports||["polling","websocket"],e.readyState="",e.writeBuffer=[],e.prevBufferLen=0,e.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},i),e.opts.path=e.opts.path.replace(/\/$/,"")+"/","string"==typeof e.opts.query&&(e.opts.query=parseqs.decode(e.opts.query)),e.id=null,e.upgrades=null,e.pingInterval=null,e.pingTimeout=null,e.pingTimeoutTimer=null,"function"==typeof addEventListener&&(e.opts.closeOnBeforeunload&&addEventListener("beforeunload",function(){e.transport&&(e.transport.removeAllListeners(),e.transport.close())},!1),"localhost"!==e.hostname&&(e.offlineEventListener=function(){e.onClose("transport close")},addEventListener("offline",e.offlineEventListener,!1))),e.open(),e}return _createClass(l,[{key:"createTransport",value:function(t){var e=clone(this.opts.query),e=(e.EIO=protocol$1,e.transport=t,this.id&&(e.sid=this.id),Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port}));return new transports[t](e)}},{key:"open",value:function(){var t,e=this;if(this.opts.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(function(){e.emitReserved("error","No transports available")},0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}},{key:"setTransport",value:function(t){var e=this;this.transport&&this.transport.removeAllListeners(),(this.transport=t).on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",function(){e.onClose("transport close")})}},{key:"probe",value:function(t){var e=this,i=this.createTransport(t),n=!1,o=(l.priorWebsocketSuccess=!1,function(){n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",function(t){n||("pong"===t.type&&"probe"===t.data?(e.upgrading=!0,e.emitReserved("upgrading",i),i&&(l.priorWebsocketSuccess="websocket"===i.name,e.transport.pause(function(){n||"closed"!==e.readyState&&(u(),e.setTransport(i),i.send([{type:"upgrade"}]),e.emitReserved("upgrade",i),i=null,e.upgrading=!1,e.flush())}))):((t=new Error("probe error")).transport=i.name,e.emitReserved("upgradeError",t)))}))});function s(){n||(n=!0,u(),i.close(),i=null)}var r=function(t){t=new Error("probe error: "+t);t.transport=i.name,s(),e.emitReserved("upgradeError",t)};function a(){r("transport closed")}function c(){r("socket closed")}function h(t){i&&t.name!==i.name&&s()}var u=function(){i.removeListener("open",o),i.removeListener("error",r),i.removeListener("close",a),e.off("close",c),e.off("upgrading",h)};i.once("open",o),i.once("error",r),i.once("close",a),this.once("close",c),this.once("upgrading",h),i.open()}},{key:"onOpen",value:function(){if(this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause)for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},{key:"onPacket",value:function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data)}}},{key:"onHandshake",value:function(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}},{key:"resetPingTimeout",value:function(){var t=this;this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(function(){t.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}},{key:"onDrain",value:function(){this.writeBuffer.splice(0,this.prevBufferLen),(this.prevBufferLen=0)===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}},{key:"flush",value:function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}},{key:"write",value:function(t,e,i){return this.sendPacket("message",t,e,i),this}},{key:"send",value:function(t,e,i){return this.sendPacket("message",t,e,i),this}},{key:"sendPacket",value:function(t,e,i,n){"function"==typeof e&&(n=e,e=void 0),"function"==typeof i&&(n=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((i=i||{}).compress=!1!==i.compress,this.emitReserved("packetCreate",t={type:t,data:e,options:i}),this.writeBuffer.push(t),n&&this.once("flush",n),this.flush())}},{key:"close",value:function(){function t(){i.off("upgrade",t),i.off("upgradeError",t),n()}function e(){i.once("upgrade",t),i.once("upgradeError",t)}var i=this,n=function(){i.onClose("forced close"),i.transport.close()};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",function(){(i.upgrading?e:n)()}):(this.upgrading?e:n)()),this}},{key:"onError",value:function(t){l.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}},{key:"onClose",value:function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}},{key:"filterUpgrades",value:function(t){for(var e=[],i=0,n=t.length;i<n;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}]),l}();function clone(t){var e,i={};for(e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}Socket$1.protocol=protocol$1;var withNativeArrayBuffer="function"==typeof ArrayBuffer,isView=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer},toString=Object.prototype.toString,withNativeBlob="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===toString.call(Blob),withNativeFile="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===toString.call(File);function isBinary(t){return withNativeArrayBuffer&&(t instanceof ArrayBuffer||isView(t))||withNativeBlob&&t instanceof Blob||withNativeFile&&t instanceof File}function hasBinary(t,e){if(!t||"object"!==_typeof(t))return!1;if(Array.isArray(t)){for(var i=0,n=t.length;i<n;i++)if(hasBinary(t[i]))return!0;return!1}if(isBinary(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return hasBinary(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&hasBinary(t[o]))return!0;return!1}function deconstructPacket(t){var e=[],i=t.data;return t.data=_deconstructPacket(i,e),t.attachments=e.length,{packet:t,buffers:e}}function _deconstructPacket(t,e){if(!t)return t;var i;if(isBinary(t))return i={_placeholder:!0,num:e.length},e.push(t),i;if(Array.isArray(t)){for(var n=new Array(t.length),o=0;o<t.length;o++)n[o]=_deconstructPacket(t[o],e);return n}if("object"!==_typeof(t)||t instanceof Date)return t;var s,r={};for(s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r[s]=_deconstructPacket(t[s],e));return r}function reconstructPacket(t,e){return t.data=_reconstructPacket(t.data,e),t.attachments=void 0,t}function _reconstructPacket(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]=_reconstructPacket(t[i],e);else if("object"===_typeof(t))for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=_reconstructPacket(t[n],e));return t}var PacketType,protocol=5,Encoder=(!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(PacketType=PacketType||{}),function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"encode",value:function(t){return t.type!==PacketType.EVENT&&t.type!==PacketType.ACK||!hasBinary(t)?[this.encodeAsString(t)]:(t.type=t.type===PacketType.EVENT?PacketType.BINARY_EVENT:PacketType.BINARY_ACK,this.encodeAsBinary(t))}},{key:"encodeAsString",value:function(t){var e=""+t.type;return t.type!==PacketType.BINARY_EVENT&&t.type!==PacketType.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data)),e}},{key:"encodeAsBinary",value:function(t){var t=deconstructPacket(t),e=this.encodeAsString(t.packet),t=t.buffers;return t.unshift(e),t}}]),t}()),Decoder=function(){_inherits(s,Emitter_1);var t=_createSuper(s);function s(){return _classCallCheck(this,s),t.call(this)}return _createClass(s,[{key:"add",value:function(t){var e;if("string"==typeof t)(e=this.decodeString(t)).type===PacketType.BINARY_EVENT||e.type===PacketType.BINARY_ACK?(this.reconstructor=new BinaryReconstructor(e),0===e.attachments&&_get(_getPrototypeOf(s.prototype),"emitReserved",this).call(this,"decoded",e)):_get(_getPrototypeOf(s.prototype),"emitReserved",this).call(this,"decoded",e);else{if(!isBinary(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(e=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,_get(_getPrototypeOf(s.prototype),"emitReserved",this).call(this,"decoded",e))}}},{key:"decodeString",value:function(t){var e=0,i={type:Number(t.charAt(0))};if(void 0===PacketType[i.type])throw new Error("unknown packet type "+i.type);if(i.type===PacketType.BINARY_EVENT||i.type===PacketType.BINARY_ACK){for(var n=e+1;"-"!==t.charAt(++e)&&e!=t.length;);n=t.substring(n,e);if(n!=Number(n)||"-"!==t.charAt(e))throw new Error("Illegal attachments");i.attachments=Number(n)}if("/"===t.charAt(e+1)){for(n=e+1;++e;){if(","===t.charAt(e))break;if(e===t.length)break}i.nsp=t.substring(n,e)}else i.nsp="/";n=t.charAt(e+1);if(""!==n&&Number(n)==n){for(n=e+1;++e;){var o=t.charAt(e);if(null==o||Number(o)!=o){--e;break}if(e===t.length)break}i.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){n=tryParse(t.substr(e));if(!s.isPayloadValid(i.type,n))throw new Error("invalid payload");i.data=n}return i}},{key:"destroy",value:function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}],[{key:"isPayloadValid",value:function(t,e){switch(t){case PacketType.CONNECT:return"object"===_typeof(e);case PacketType.DISCONNECT:return void 0===e;case PacketType.CONNECT_ERROR:return"string"==typeof e||"object"===_typeof(e);case PacketType.EVENT:case PacketType.BINARY_EVENT:return Array.isArray(e)&&0<e.length;case PacketType.ACK:case PacketType.BINARY_ACK:return Array.isArray(e)}}}]),s}();function tryParse(t){try{return JSON.parse(t)}catch(t){return!1}}var BinaryReconstructor=function(){function e(t){_classCallCheck(this,e),this.packet=t,this.buffers=[],this.reconPack=t}return _createClass(e,[{key:"takeBinaryData",value:function(t){return this.buffers.push(t),this.buffers.length===this.reconPack.attachments?(t=reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),t):null}},{key:"finishedReconstruction",value:function(){this.reconPack=null,this.buffers=[]}}]),e}(),parser=Object.freeze({__proto__:null,protocol:protocol,get PacketType(){return PacketType},Encoder:Encoder,Decoder:Decoder});function on(t,e,i){return t.on(e,i),function(){t.off(e,i)}}var RESERVED_EVENTS=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Socket=function(){_inherits(s,Emitter_1);var o=_createSuper(s);function s(t,e,i){var n;return _classCallCheck(this,s),(n=o.call(this)).connected=!1,n.disconnected=!0,n.receiveBuffer=[],n.sendBuffer=[],n.ids=0,n.acks={},n.flags={},n.io=t,n.nsp=e,i&&i.auth&&(n.auth=i.auth),n.io._autoConnect&&n.open(),n}return _createClass(s,[{key:"subEvents",value:function(){var t;this.subs||(t=this.io,this.subs=[on(t,"open",this.onopen.bind(this)),on(t,"packet",this.onpacket.bind(this)),on(t,"error",this.onerror.bind(this)),on(t,"close",this.onclose.bind(this))])}},{key:"active",get:function(){return!!this.subs}},{key:"connect",value:function(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}},{key:"open",value:function(){return this.connect()}},{key:"send",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.unshift("message"),this.emit.apply(this,e),this}},{key:"emit",value:function(t){if(RESERVED_EVENTS.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');for(var e=arguments.length,i=new Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];i.unshift(t);var o,t={type:PacketType.EVENT,data:i,options:{}},s=(t.options.compress=!1!==this.flags.compress,"function"==typeof i[i.length-1]&&(o=this.ids++,s=i.pop(),this._registerAckCallback(o,s),t.id=o),this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable);return this.flags.volatile&&(!s||!this.connected)||(this.connected?this.packet(t):this.sendBuffer.push(t)),this.flags={},this}},{key:"_registerAckCallback",value:function(e,n){var o,s=this,t=this.flags.timeout;void 0===t?this.acks[e]=n:(o=this.io.setTimeoutFn(function(){delete s.acks[e];for(var t=0;t<s.sendBuffer.length;t++)s.sendBuffer[t].id===e&&s.sendBuffer.splice(t,1);n.call(s,new Error("operation has timed out"))},t),this.acks[e]=function(){s.io.clearTimeoutFn(o);for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n.apply(s,[null].concat(e))})}},{key:"packet",value:function(t){t.nsp=this.nsp,this.io._packet(t)}},{key:"onopen",value:function(){var e=this;"function"==typeof this.auth?this.auth(function(t){e.packet({type:PacketType.CONNECT,data:t})}):this.packet({type:PacketType.CONNECT,data:this.auth})}},{key:"onerror",value:function(t){this.connected||this.emitReserved("connect_error",t)}},{key:"onclose",value:function(t){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",t)}},{key:"onpacket",value:function(t){if(t.nsp===this.nsp)switch(t.type){case PacketType.CONNECT:t.data&&t.data.sid?(e=t.data.sid,this.onconnect(e)):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case PacketType.EVENT:case PacketType.BINARY_EVENT:this.onevent(t);break;case PacketType.ACK:case PacketType.BINARY_ACK:this.onack(t);break;case PacketType.DISCONNECT:this.ondisconnect();break;case PacketType.CONNECT_ERROR:this.destroy();var e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e)}}},{key:"onevent",value:function(t){var e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}},{key:"emitEvent",value:function(t){if(this._anyListeners&&this._anyListeners.length){var e,i=_createForOfIteratorHelper(this._anyListeners.slice());try{for(i.s();!(e=i.n()).done;)e.value.apply(this,t)}catch(t){i.e(t)}finally{i.f()}}_get(_getPrototypeOf(s.prototype),"emit",this).apply(this,t)}},{key:"ack",value:function(n){var o=this,s=!1;return function(){if(!s){s=!0;for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];o.packet({type:PacketType.ACK,id:n,data:e})}}}},{key:"onack",value:function(t){var e=this.acks[t.id];"function"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}},{key:"onconnect",value:function(t){this.id=t,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}},{key:"emitBuffered",value:function(){var e=this;this.receiveBuffer.forEach(function(t){return e.emitEvent(t)}),this.receiveBuffer=[],this.sendBuffer.forEach(function(t){return e.packet(t)}),this.sendBuffer=[]}},{key:"ondisconnect",value:function(){this.destroy(),this.onclose("io server disconnect")}},{key:"destroy",value:function(){this.subs&&(this.subs.forEach(function(t){return t()}),this.subs=void 0),this.io._destroy(this)}},{key:"disconnect",value:function(){return this.connected&&this.packet({type:PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{key:"close",value:function(){return this.disconnect()}},{key:"compress",value:function(t){return this.flags.compress=t,this}},{key:"volatile",get:function(){return this.flags.volatile=!0,this}},{key:"timeout",value:function(t){return this.flags.timeout=t,this}},{key:"onAny",value:function(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}},{key:"prependAny",value:function(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}},{key:"offAny",value:function(t){if(!this._anyListeners)return this;if(t){for(var e=this._anyListeners,i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyListeners=[];return this}},{key:"listenersAny",value:function(){return this._anyListeners||[]}}]),s}(),backo2=Backoff;function Backoff(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=0<t.jitter&&t.jitter<=1?t.jitter:0,this.attempts=0}Backoff.prototype.duration=function(){var t,e,i=this.ms*Math.pow(this.factor,this.attempts++);return this.jitter&&(t=Math.random(),e=Math.floor(t*this.jitter*i),i=0==(1&Math.floor(10*t))?i-e:i+e),0|Math.min(i,this.max)},Backoff.prototype.reset=function(){this.attempts=0},Backoff.prototype.setMin=function(t){this.ms=t},Backoff.prototype.setMax=function(t){this.max=t},Backoff.prototype.setJitter=function(t){this.jitter=t};var Manager=function(){_inherits(s,Emitter_1);var o=_createSuper(s);function s(t,e){_classCallCheck(this,s),(i=o.call(this)).nsps={},i.subs=[],t&&"object"===_typeof(t)&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",i.opts=e,installTimerFunctions(_assertThisInitialized(i),e),i.reconnection(!1!==e.reconnection),i.reconnectionAttempts(e.reconnectionAttempts||1/0),i.reconnectionDelay(e.reconnectionDelay||1e3),i.reconnectionDelayMax(e.reconnectionDelayMax||5e3),i.randomizationFactor(null!=(n=e.randomizationFactor)?n:.5),i.backoff=new backo2({min:i.reconnectionDelay(),max:i.reconnectionDelayMax(),jitter:i.randomizationFactor()}),i.timeout(null==e.timeout?2e4:e.timeout),i._readyState="closed",i.uri=t;var i,n=e.parser||parser;return i.encoder=new n.Encoder,i.decoder=new n.Decoder,i._autoConnect=!1!==e.autoConnect,i._autoConnect&&i.open(),i}return _createClass(s,[{key:"reconnection",value:function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}},{key:"reconnectionAttempts",value:function(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}},{key:"reconnectionDelay",value:function(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null!=(e=this.backoff)&&e.setMin(t),this)}},{key:"randomizationFactor",value:function(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null!=(e=this.backoff)&&e.setJitter(t),this)}},{key:"reconnectionDelayMax",value:function(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null!=(e=this.backoff)&&e.setMax(t),this)}},{key:"timeout",value:function(t){return arguments.length?(this._timeout=t,this):this._timeout}},{key:"maybeReconnectOnOpen",value:function(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}},{key:"open",value:function(e){var i=this;if(~this._readyState.indexOf("open"))return this;this.engine=new Socket$1(this.uri,this.opts);var t,n,o=this.engine,s=this,r=(this._readyState="opening",this.skipReconnect=!1,on(o,"open",function(){s.onopen(),e&&e()})),a=on(o,"error",function(t){s.cleanup(),s._readyState="closed",i.emitReserved("error",t),e?e(t):s.maybeReconnectOnOpen()});return!1!==this._timeout&&(0===(t=this._timeout)&&r(),n=this.setTimeoutFn(function(){r(),o.close(),o.emit("error",new Error("timeout"))},t),this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})),this.subs.push(r),this.subs.push(a),this}},{key:"connect",value:function(t){return this.open(t)}},{key:"onopen",value:function(){this.cleanup(),this._readyState="open",this.emitReserved("open");var t=this.engine;this.subs.push(on(t,"ping",this.onping.bind(this)),on(t,"data",this.ondata.bind(this)),on(t,"error",this.onerror.bind(this)),on(t,"close",this.onclose.bind(this)),on(this.decoder,"decoded",this.ondecoded.bind(this)))}},{key:"onping",value:function(){this.emitReserved("ping")}},{key:"ondata",value:function(t){this.decoder.add(t)}},{key:"ondecoded",value:function(t){this.emitReserved("packet",t)}},{key:"onerror",value:function(t){this.emitReserved("error",t)}},{key:"socket",value:function(t,e){var i;return(i=this.nsps[t])||(i=new Socket(this,t,e),this.nsps[t]=i),i}},{key:"_destroy",value:function(t){for(var e=0,i=Object.keys(this.nsps);e<i.length;e++){var n=i[e];if(this.nsps[n].active)return}this._close()}},{key:"_packet",value:function(t){for(var e=this.encoder.encode(t),i=0;i<e.length;i++)this.engine.write(e[i],t.options)}},{key:"cleanup",value:function(){this.subs.forEach(function(t){return t()}),this.subs.length=0,this.decoder.destroy()}},{key:"_close",value:function(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}},{key:"disconnect",value:function(){return this._close()}},{key:"onclose",value:function(t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()}},{key:"reconnect",value:function(){var e=this;if(this._reconnecting||this.skipReconnect)return this;var t,i,n=this;this.backoff.attempts>=this._reconnectionAttempts?(this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1):(t=this.backoff.duration(),this._reconnecting=!0,i=this.setTimeoutFn(function(){n.skipReconnect||(e.emitReserved("reconnect_attempt",n.backoff.attempts),n.skipReconnect||n.open(function(t){t?(n._reconnecting=!1,n.reconnect(),e.emitReserved("reconnect_error",t)):n.onreconnect()}))},t),this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)}))}},{key:"onreconnect",value:function(){var t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}]),s}(),cache={};function lookup(t,e){"object"===_typeof(t)&&(e=t,t=void 0);var t=url(t,(e=e||{}).path||"/socket.io"),i=t.source,n=t.id,o=t.path,o=cache[n]&&o in cache[n].nsps,o=e.forceNew||e["force new connection"]||!1===e.multiplex||o?new Manager(i,e):(cache[n]||(cache[n]=new Manager(i,e)),cache[n]);return t.query&&!e.query&&(e.query=t.queryKey),o.socket(t.path,e)}Object.assign(lookup,{Manager:Manager,Socket:Socket,io:lookup,connect:lookup});class SocketService{constructor(t){this.socket=t}atualizaDadosPersonagem(t){t=Object.values(t);this.socket.emit("anyChange",t)}SendChat(t){this.socket.emit("chatMessage",JSON.stringify(t))}setLogoutCallback(e){this.socket.on("logout",t=>{e(t)})}setAnyChangeCallback(e){this.socket.on("anyChange",t=>{t=t.map(t=>({id:t[0],nome:t[1],picture:t[2],x:t[3],y:t[4]}));e(t)})}setChatChangeCallback(e){this.socket.on("chatMessage",t=>{e(JSON.parse(t))})}}class WatchMove{constructor(t,e){this.directions=[],this.position=t,this.socketForSend=new SocketService(lookup("https://ws.realtime.eduardoworrel.com")),e.id=this.randonTokenString(),this.character=e,this.move(e)}randonTokenString(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}move(t){setInterval(()=>{this.directions.includes("ArrowUp")&&(this.position.vertical>limit.minX&&(this.position.vertical-=speed.distance),t.style.top=this.position.vertical+speed.unit,this.updatePosition()),this.directions.includes("ArrowDown")&&(this.position.vertical<limit.maxX&&(this.position.vertical+=speed.distance),t.style.top=this.position.vertical+speed.unit,this.updatePosition()),this.directions.includes("ArrowLeft")&&(this.position.horizontal>limit.minY&&(this.position.horizontal-=speed.distance),t.style.left=this.position.horizontal+speed.unit,this.updatePosition()),this.directions.includes("ArrowRight")&&(this.position.horizontal<limit.maxY&&(this.position.horizontal+=speed.distance),t.style.left=this.position.horizontal+speed.unit,this.updatePosition())},speed.ms)}updatePosition(){this.character.scrollIntoView({block:"center",inline:"center",behavior:"auto"}),this.socketForSend.atualizaDadosPersonagem({id:this.character.id,nome:"",picture:"",x:this.position.horizontal,y:this.position.vertical})}togglePressedKeyboard(){this.up=document.querySelector(".up"),this.down=document.querySelector(".down"),this.left=document.querySelector(".left"),this.right=document.querySelector(".right"),setInterval(()=>{this.directions.includes("ArrowUp")?(this.up.classList.add("active"),this.up.classList.add("focus")):(this.up.classList.remove("active"),this.up.classList.remove("focus")),this.directions.includes("ArrowDown")?(this.down.classList.add("active"),this.down.classList.add("focus")):(this.down.classList.remove("active"),this.down.classList.remove("focus")),this.directions.includes("ArrowLeft")?(this.left.classList.add("active"),this.left.classList.add("focus")):(this.left.classList.remove("active"),this.left.classList.remove("focus")),this.directions.includes("ArrowRight")?(this.right.classList.add("active"),this.right.classList.add("focus")):(this.right.classList.remove("active"),this.right.classList.remove("focus"))},100)}}class Move{static attach(t){const e=new WatchMove(position,t),i=new Move$2(e),n=new Move$1(e);i.start(),n.start(),e.togglePressedKeyboard()}}class Character{constructor(t){var e=document.createElement("div");t.append(e),this.character=e,Move.attach(this.character)}start(){this.drawMe()}drawMe(){this.character.setAttribute("style",`
                position:absolute;
                width: ${defaultSize.width}px; 
                height: ${defaultSize.height}px;
                background-image: url('https://i.pinimg.com/originals/a0/26/1b/a0261b885cfba5a65c675c33327acf5a.png');
                background-size: 100%;
                top: ${position.vertical}px;
                left: ${position.horizontal}px;     
                z-index: 9999;   
          `)}}class Sun{constructor(t,e,i,n){this.width=t*i,this.height=e*i,this.mass=this.width*this.height,this.x=(3e3-this.width)/2,this.y=(3e3-this.height)/2,(this.img=n).style.width=this.width+"px",n.style.height=this.height+"px",n.style.left=this.x+"px",n.style.top=this.y+"px",n.style.position="absolute",this.element=n}}const G=.04;function getAngSpeed(t,e){e=G*e;return Math.sqrt(e)*Math.pow(t,-1.5)}const spacing=100;class Moon{constructor(t,e,i,n){this.moonImg="assets/images/space-elements/lua.gif",this.angle=i,this.angSpeed=getAngSpeed(3*spacing,n),this.width=t,this.height=e,this.radius=4*spacing,this.mass=this.width*this.height;const o=document.createElement("img");o.src=this.moonImg,o.style.width=this.width+"px",o.style.height=this.height+"px",o.style.left=this.x+"px",o.style.top=this.y+"px",o.style.position="absolute",this.element=o}update(t,e){this.angle+=this.angSpeed,this.x=t+this.width+Math.cos(this.angle)*this.radius,this.y=e+this.height-Math.sin(this.angle)*this.radius,this.element.style.left=this.x+"px",this.element.style.top=this.y+"px"}}class Planet{constructor(t,e,i,n,o,s){this.earthImg="assets/images/space-elements/terra.gif",this.name=t,this.widthFactor=e,this.heightFactor=i,this.width=this.widthFactor,this.height=this.heightFactor,this.radius=n,this.mass=this.width*this.height,this.angle=o,this.angSpeed=getAngSpeed(2*this.radius,s),this.x=2850-this.width/2+Math.cos(this.angle)*this.radius,this.y=2850-this.height/2-Math.sin(this.angle)*this.radius;const r=document.createElement("img");r.src=this.earthImg,(this.img=r).style.width=this.width+"px",r.style.height=this.height+"px",r.style.left=this.x+"px",r.style.top=this.y+"px",r.style.position="absolute",this.element=r,this.moon=new Moon(90,90,this.angle,this.mass),setInterval(()=>{this.angle+=this.angSpeed,this.x=1425+Math.cos(this.angle)*this.radius,this.y=1425-Math.sin(this.angle)*this.radius,this.element.style.left=this.x+"px",this.element.style.top=this.y+"px",this.moon.update(this.x,this.y)},50)}}class Universe{constructor(t){this.spacing=100,this.planets=[],this.rockets={},this.rocketCounter=0,this.launchAngle=0,this.usePlanetGrav=!1,this.useCollisions=!1,this.planetScale=2,this.launchVel=10,this.innerWidth=3e3,this.innerHeight=3e3,this.space=t,this.loadImages(),this.drawStaticSun();t=new Planet("Earth",250,250,9*this.spacing,0,this.sun.mass);this.planets.push(t),this.space.append(t.element),this.space.append(t.moon.element),this.planets.push(t)}drawStaticSun(){this.sun=new Sun(600,600,this.planetScale,this.sunImg),this.space.append(this.sun.element)}loadImages(){this.sunImg=document.createElement("img"),this.sunImg.src="assets/images/space-elements/estrela.gif",this.rocketImg="assets/images/rocket.png"}}const real=document.querySelector("#realcontent");if(!real)throw new Error('O elemento "realcontent" é obrigatório');const character=new Character(real);character.start(),new Universe(real);
